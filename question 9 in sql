CREATE TABLE average_carbon (
    year_id INT,
    average_carbon DECIMAL(10, 2)
);

ALTER TABLE selected_recipes
ADD COLUMN year INT;

ALTER TABLE nutritionalinfo
ADD COLUMN recipe_name VARCHAR(255);

UPDATE nutritionalinfo ni
JOIN (
    SELECT 1 AS recipe_id, 'Thai Chicken' AS recipe_name UNION ALL
    SELECT 2, 'Turkey Soup' UNION ALL
    SELECT 3, 'Ham and Potato Soup' UNION ALL
    SELECT 4, 'Batter Herb Chicken' UNION ALL
    SELECT 5, 'Kung Pao Chicken' UNION ALL
    SELECT 6, 'One Pot Chicken and Potatoes' UNION ALL
    SELECT 7, 'Buckwheat Chicken Pilaf' UNION ALL
    SELECT 8, 'Bacon and Honey Potato Salad' UNION ALL
    SELECT 9, 'Honey Lime Chicken' UNION ALL
    SELECT 10, 'Potato Apple Roast'
) r ON ni.recipe_id = r.recipe_id
SET ni.recipe_name = r.recipe_name;


CREATE TABLE average2_carbon (
    id INT AUTO_INCREMENT PRIMARY KEY,
    average_carbon DECIMAL(10, 2)
);

CREATE TRIGGER update_average_carbon_trigger AFTER INSERT ON selected_recipes
FOR EACH ROW
BEGIN
    DECLARE total_carbohydrates DECIMAL(10, 2);

    -- Calculate the total carbohydrates per serving for the new recipe
    SELECT SUM(ni.carbohydrates_per_serving)
    INTO total_carbohydrates
    FROM nutritionalinfo ni
    JOIN selected_recipes sr ON ni.recipe_name = sr.recipe_name
    WHERE sr.recipe_name = NEW.recipe_name;

    -- Update the average_carbon table
    INSERT INTO average_carbon (average_carbon)
    VALUES (total_carbohydrates);
END;



DELIMITER //

CREATE TRIGGER update_average2_carbon_trigger AFTER INSERT ON average_carbon
FOR EACH ROW
BEGIN
    DECLARE total_carbon DECIMAL(10, 2);
    DECLARE current_count INT;
    
    -- Get the current count of rows in the average_carbon table
    SELECT COUNT(*) INTO current_count FROM average_carbon;
    
    -- If the current count is a multiple of 100, sum all values in the average_carbon table
    IF current_count % 100 = 0 THEN
        -- Calculate the total carbon by summing all values in the average_carbon table
        SELECT SUM(average_carbon)
        INTO total_carbon
        FROM average_carbon;
        
        -- Calculate the average carbon by dividing the total carbon by the number of rows
        SET total_carbon = total_carbon / current_count;
        
        -- Replace the existing entry in the average2_carbon table with the new average carbon value
        REPLACE INTO average2_carbon (average_carbon)
        VALUES (total_carbon);
    END IF;
END;
//

DELIMITER ;
