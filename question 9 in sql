CREATE TABLE average_carbon (
    year_id INT,
    average_carbon DECIMAL(10, 2)
);

ALTER TABLE average_carbon
ADD PRIMARY KEY (year_id);


UPDATE nutritionalinfo ni
JOIN (
    SELECT 1 AS recipe_id, 'Thai Chicken' AS recipe_name UNION ALL
    SELECT 2, 'Turkey Soup' UNION ALL
    SELECT 3, 'Ham and Potato Soup' UNION ALL
    SELECT 4, 'Batter Herb Chicken' UNION ALL
    SELECT 5, 'Kung Pao Chicken' UNION ALL
    SELECT 6, 'One Pot Chicken and Potatoes' UNION ALL
    SELECT 7, 'Buckwheat Chicken Pilaf' UNION ALL
    SELECT 8, 'Bacon and Honey Potato Salad' UNION ALL
    SELECT 9, 'Honey Lime Chicken' UNION ALL
    SELECT 10, 'Potato Apple Roast'
) r ON ni.recipe_id = r.recipe_id
SET ni.recipe_name = r.recipe_name;


CREATE TABLE average2_carbon (
    id INT AUTO_INCREMENT PRIMARY KEY,
    average_carbon DECIMAL(10, 2)
);

DELIMITER //
CREATE TRIGGER update_average_carbon_trigger 
AFTER INSERT ON selected_recipes 
FOR EACH ROW 
BEGIN
    DECLARE carbs DECIMAL(10, 2);
    
    -- Get the carbohydrates_per_serving for the new recipe
    SELECT ni.carbohydrates_per_serving
    INTO carbs
    FROM nutritionalinfo ni
    WHERE ni.recipe_name = NEW.recipe_name;
    
    -- Insert the carbohydrates_per_serving into the average_carbon table
    INSERT INTO average_carbon (average_carbon)
    VALUES (carbs);
END;
//

DELIMITER ;

ALTER TABLE average2_carbon ADD COLUMN year_id INT;

DELIMITER //

CREATE TRIGGER update_average2_carbon_trigger AFTER INSERT ON average_carbon
FOR EACH ROW
BEGIN
    DECLARE total_carbon DECIMAL(10, 2);
    DECLARE current_count INT;
    DECLARE new_year INT;

    -- Get the current count of rows in the average_carbon table
    SELECT COUNT(*) INTO current_count FROM average_carbon;
    
    -- If the current count is a multiple of 100, sum all values in the average_carbon table
    IF current_count % 100 = 0 THEN
        -- Calculate the total carbon by summing all values in the average_carbon table
        SELECT SUM(average_carbon)
        INTO total_carbon
        FROM average_carbon;
        
        -- Calculate the average carbon by dividing the total carbon by the number of rows
        SET total_carbon = total_carbon / current_count;
        
        -- Insert the new average carbon value into the average2_carbon table
        INSERT INTO average2_carbon (average_carbon, year_id)
        VALUES (total_carbon, 2000 + current_count / 100);
    END IF;
END;
//

DELIMITER ;

